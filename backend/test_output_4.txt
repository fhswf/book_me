npm warn config ignoring workspace config at /home/cgawron/git/book_me/backend/.npmrc

 RUN  v2.1.3 /home/cgawron/git/book_me/backend

stdout | src/test/server.spec.ts > Server routes
[31merror[39m: CLIENT_SECRET not set! {"service":"appoint-backend","timestamp":"2025-12-03 19:01:43"}
[31merror[39m: CLIENT_ID not set! {"service":"appoint-backend","timestamp":"2025-12-03 19:01:43"}

stdout | src/test/server.spec.ts > Server routes
[32minfo[39m: env: {"parsed":{"MONGO_URI":"mongodb://mongo-bookme:27017","API_URL":"https://hopper.fh-swf.de/meeting/api/v1","CLIENT_URL":"https://hopper.fh-swf.de/meeting","BASE_PATH":"/meeting","TZ":"Europe/Berlin"}} {"service":"appoint-backend","timestamp":"2025-12-03 19:01:43"}
[32minfo[39m: NODE_ENV: test {"service":"appoint-backend","timestamp":"2025-12-03 19:01:43"}
[32minfo[39m: CLIENT_URL: https://hopper.fh-swf.de/meeting {"service":"appoint-backend","timestamp":"2025-12-03 19:01:43"}
[32minfo[39m: MONGO_URI: mongodb://mongo-bookme:27017 {"service":"appoint-backend","timestamp":"2025-12-03 19:01:43"}
[32minfo[39m: CLIENT_ID: undefined {"service":"appoint-backend","timestamp":"2025-12-03 19:01:43"}
[32minfo[39m: enabling CORS for ["https://hopper.fh-swf.de/meeting","https://appoint.gawron.cloud"] {"service":"appoint-backend","timestamp":"2025-12-03 19:01:43"}

stdout | src/test/server.spec.ts > Server routes > should return unauthorized
[32minfo[39m: Server running on Port 5000 {"service":"appoint-backend","timestamp":"2025-12-03 19:01:43"}

stdout | src/test/server.spec.ts > Server routes > should return unauthorized
mocked requireAuth

stdout | src/test/server.spec.ts > Server routes > should return unauthorized
{ error: 'Unauthorized' }

stdout | src/test/server.spec.ts > Server routes > should return the user
mocked requireAuth
UserModel: mocked findOne
{
  _id: '109150731150582581691',
  __v: 0,
  email: 'christian.gawron@gmail.com',
  name: 'Christian Gawron',
  picture_url: 'https://lh3.googleusercontent.com/a/ACg8ocL0Ob8tDn2tEvCfdg4OfH8g_hMqcf_IGBRulp0PuBXVNf8PdJ6OyA=s96-c',
  pull_calendars: [
    'christian.gawron@gmail.com',
    'fj2g7ii3on2elc092n3tbd1nmv48mb3n@import.calendar.google.com',
    'family10045043731026254769@group.calendar.google.com',
    'de.german.official#holiday@group.v.calendar.google.com',
    't6hldgptmgr36ctkm1720bvcfg@group.calendar.google.com',
    'gawron.christian@fh-swf.de'
  ],
  user_url: 'christian-gawron',
  push_calendar: 't6hldgptmgr36ctkm1720bvcfg@group.calendar.google.com',
  google_tokens: {
    access_token: 'mock_access_token',
    refresh_token: 'mock_refresh_token',
    scope: 'https://www.googleapis.com/auth/calendar',
    token_type: 'Bearer',
    expiry_date: 1634567890000
  }
}

stdout | src/test/server.spec.ts > Server routes > should get the user by url
mocked requireAuth
UserModel: mocked findOne
{
  _id: '109150731150582581691',
  __v: 0,
  email: 'christian.gawron@gmail.com',
  name: 'Christian Gawron',
  picture_url: 'https://lh3.googleusercontent.com/a/ACg8ocL0Ob8tDn2tEvCfdg4OfH8g_hMqcf_IGBRulp0PuBXVNf8PdJ6OyA=s96-c',
  pull_calendars: [
    'christian.gawron@gmail.com',
    'fj2g7ii3on2elc092n3tbd1nmv48mb3n@import.calendar.google.com',
    'family10045043731026254769@group.calendar.google.com',
    'de.german.official#holiday@group.v.calendar.google.com',
    't6hldgptmgr36ctkm1720bvcfg@group.calendar.google.com',
    'gawron.christian@fh-swf.de'
  ],
  user_url: 'christian-gawron',
  push_calendar: 't6hldgptmgr36ctkm1720bvcfg@group.calendar.google.com',
  google_tokens: {
    access_token: 'mock_access_token',
    refresh_token: 'mock_refresh_token',
    scope: 'https://www.googleapis.com/auth/calendar',
    token_type: 'Bearer',
    expiry_date: 1634567890000
  }
}

stdout | src/test/server.spec.ts > Server routes > should get available slots for 'sprechstunde'
EventModel: mocked findOne
mocked findOne select
mocked findOne exec
UserModel: mocked findOne
mocked google.calendar
freeBusy called for 109150731150582581691
UserModel: mocked findOne
mocked google.calendar
mocked query
freeSlots length: 0
Filtered slots type: IntervalSet
Filtered slots: IntervalSet(1) [ 0 ]
[31merror[39m: getAvailableTime: event not found or freeBusy failed: TypeError: Cannot create property 'start' on number '0'
    at /home/cgawron/git/book_me/common/src/types.ts:185:14
    at IntervalSet.forEach (<anonymous>)
    at IntervalSet.initializeWithArray (/home/cgawron/git/book_me/common/src/types.ts:184:9)
    at new IntervalSet (/home/cgawron/git/book_me/common/src/types.ts:142:12)
    at /home/cgawron/git/book_me/backend/src/controller/event_controller.ts:71:19
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  [stack]: [Getter/Setter],
  [message]: "Cannot create property 'start' on number '0'"
} {"service":"appoint-backend","timestamp":"2025-12-03 19:01:43"}
Status: 400
Body: {
  "error": {},
  "message": "Cannot create property 'start' on number '0'",
  "stack": "TypeError: Cannot create property 'start' on number '0'\n    at /home/cgawron/git/book_me/common/src/types.ts:185:14\n    at IntervalSet.forEach (<anonymous>)\n    at IntervalSet.initializeWithArray (/home/cgawron/git/book_me/common/src/types.ts:184:9)\n    at new IntervalSet (/home/cgawron/git/book_me/common/src/types.ts:142:12)\n    at /home/cgawron/git/book_me/backend/src/controller/event_controller.ts:71:19\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)"
}

stdout | src/test/server.spec.ts > Server routes > should get the event by url
EventModel: mocked findOne
mocked findOne exec
{
  available: {
    '0': [],
    '1': [ [Object] ],
    '2': [ [Object] ],
    '3': [],
    '4': [],
    '5': [],
    '6': []
  },
  _id: '66e41e641f4f81ece1828ab5',
  user: '109150731150582581691',
  name: 'Sprechstunde',
  location: 'https://fh-swf.zoom.us/my/cgawron',
  description: '30 Minuten online',
  duration: 30,
  url: 'sprechstunde',
  isActive: true,
  bufferbefore: 5,
  bufferafter: 15,
  minFuture: 172800,
  maxFuture: 5184000,
  maxPerDay: 2,
  __v: 0
}

 âœ“ src/test/server.spec.ts > Server routes > should return unauthorized
 âœ“ src/test/server.spec.ts > Server routes > should return the user
 âœ“ src/test/server.spec.ts > Server routes > should get the user by url
 Ã— src/test/server.spec.ts > Server routes > should get available slots for 'sprechstunde'
   â†’ expected 400 to deeply equal 200
 âœ“ src/test/server.spec.ts > Server routes > should get the event by url

â¯â¯â¯â¯â¯â¯â¯ Failed Tests 1 â¯â¯â¯â¯â¯â¯â¯

 FAIL  src/test/server.spec.ts > Server routes > should get available slots for 'sprechstunde'
AssertionError: expected 400 to deeply equal 200

- Expected
+ Received

- 200
+ 400

 â¯ src/test/server.spec.ts:202:24
    200|     console.log("Status:", res.status);
    201|     console.log("Body:", JSON.stringify(res.body, null, 2));
    202|     expect(res.status).toEqual(200);
       |                        ^
    203|     console.log(res.body);
    204|   })

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/1]â¯

 Test Files  1 failed (1)
      Tests  1 failed | 4 passed (5)
   Start at  18:01:42
   Duration  1.40s (transform 181ms, setup 0ms, collect 113ms, tests 845ms, environment 0ms, prepare 64ms)

